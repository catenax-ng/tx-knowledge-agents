name: Nuclei - Vulnerability Scan and API Authentication Test

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  nuclei-scan-and-auth-test:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 16

      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Nuclei - Vulnerability Scan
        uses: projectdiscovery/nuclei-action@main
        with:
          target: https://knowledge.dev.demo.catena-x.net/conforming-agent/bind

      - name: API Authentication Test
        run: |
          # Perform API authentication testing using curl
          # Replace the placeholder URLs with the actual API endpoints
          curl -X GET https://knowledge.dev.demo.catena-x.net/conforming-agent/bind --user "foo:foo"
          curl -X GET https://knowledge.dev.demo.catena-x.net/conforming-agent/bind --header 'Authorization: Basic Zm9vOmJhkcg='
          curl -X GET https://knowledge.dev.demo.catena-x.net/conforming-agent/bind --header 'X-Api-Key: dPwZtC*J+'
          curl -X GET https://knowledge.dev.demo.catena-x.net/conforming-agent/bind --header "Authorization: Bearer eyJgbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJIVUgzYjZrMzZvbFNQVTRDRTRaMVUxUjhVeHg4eFQwS3p4QXdLb3NkVk1VIn0.eyJleHAiOjE2OTQxNjc1OTUsImlhdCI6MTY5NDE2NzI5NSwiYXV0aF90aW1lIjoxNjk0MTY3Mjk0LCJqdGkiOiI3Njc5OWI1NS1iZDUzLTRhYTctOWJhNy02ODg5MWVmMzhlY2MiLCJpc3MiOiJodHRwczovL2NlbnRyYWxpZHAuaW50LmRlbW8uY2F0ZW5hLXgubmV0L2F1dGgvcmVhbG1zL0NYLUNlbnRyYWwiLCJhdWQiOlsiQ2wxLUNYLVJlZ2lzdHJhdGlvbiIsIkNsMi1DWC1Qb3J0YWwiLCJyZWFsbS1tYW5hZ2VtZW50IiwiQ2w0LUNYLURpZ2l0YWxUd2luIiwiYWNjb3VudCIsIkNsMy1DWC1TZW1hbnRpYyJdLCJzdWIiOiI0MTUzYmI5OC1iNjYzLTRkZmMtYjE2OS00NThmNTYxNGVkMDkiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJDbDItQ1gtUG9ydGFsIiwibm9uY2UiOiIyZTJkN2I2ZC1kZmFlLTQ4NGEtOTIwMi1mMDBmYTMyNjk4NjQiLCJzZXNzaW9uX3N0YXRlIjoiODljYzgzMTctZWM5Yy00NjY2LTg1NDYtNTUyZmY3ZTNjNTNmIiwiYWNyIjoiMSIsImFsbG93ZWQtb3JpZ2lucyI6WyJodHRwczovL3BhcnRuZXJzLXBvb2wuaW50LmRlbW8uY2F0ZW5hLXgubmV0IiwiaHR0cHM6Ly9jYXRlbmF4LWJwZG0taW50LmRlbW8uY2F0ZW5hLXgubmV0IiwiaHR0cDovL2xvY2FsaG9zdDo4MDgwIiwiaHR0cHM6Ly9wYXJ0bmVycy1nYXRlLmludC5kZW1vLmNhdGVuYS14Lm5ldCIsImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMCIsImh0dHBzOi8vcG9ydGFsLXN3YWdnZXIuaW50LmRlbW8uY2F0ZW5hLXgubmV0IiwiaHR0cHM6Ly9wb3J0YWwuaW50LmRlbW8uY2F0ZW5hLXgubmV0Il0sInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsImRlZmF1bHQtcm9sZXMtY2F0ZW5hLXggcmVhbG0iLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7InJlYWxtLW1hbmFnZW1lbnQiOnsicm9sZXMiOlsibWFuYWdlLXVzZXJzIiwidmlldy1jbGllbnRzIiwicXVlcnktY2xpZW50cyJdfSwiQ2wxLUNYLVJlZ2lzdHJhdGlvbiI6eyJyb2xlcyI6WyJ2aWV3X3JlZ2lzdHJhdGlvbiJdfSwiQ2w0LUNYLURpZ2l0YWxUd2luIjp7InJvbGVzIjpbInZpZXdfZGlnaXRhbF90d2luIl19LCJDbDItQ1gtUG9ydGFsIjp7InJvbGVzIjpbIm1vZGlmeV91c2VyX2FjY291bnQiLCJ2aWV3X3NlcnZpY2VzIiwidmlld19kYXRhc3BhY2VzIiwiYXBwX21hbmFnZW1lbnQiLCJkZWxldGVfaWRwIiwic2V0dXBfaWRwIiwidmlld190ZWNoX3JvbGVzIiwiYWRkX2lkcCIsInZpZXdfY29tcGFueV9kYXRhIiwiZGVsZXRlX25vdGlmaWNhdGlvbnMiLCJhZGRfY29ubmVjdG9ycyIsInN1YnNjcmliZV9zZXJ2aWNlX29mZmVyaW5nIiwiQ29tcGFueSBBZG1pbiIsImRlbGV0ZV9kb2N1bWVudHMiLCJ2aWV3X2Nvbm5lY3RvcnMiLCJ2aWV3X3RlY2hfdXNlcl9tYW5hZ2VtZW50Iiwic3Vic2NyaWJlX2FwcHMiLCJyZXF1ZXN0X3NzaWNyZWRlbnRpYWwiLCJhZGRfc2VsZl9kZXNjcmlwdGlvbnMiLCJ2aWV3X2FwcF9sYW5ndWFnZSIsImFkZF90ZWNoX3VzZXJfbWFuYWdlbWVudCIsInZpZXdfcGFydG5lcl9uZXR3b3JrIiwiZmlsdGVyX2FwcHMiLCJ1cGRhdGVfY29tcGFueV9yb2xlIiwidmlld19zZXJ2aWNlX29mZmVyaW5nIiwidmlld191c2VyX2FjY291bnQiLCJ2aWV3X2NsaWVudF9yb2xlcyIsInZpZXdfZG9jdW1lbnRzIiwidmlld191c2VfY2FzZV9wYXJ0aWNpcGF0aW9uIiwidmlld19zdWJzY3JpcHRpb24iLCJkZWxldGVfY29ubmVjdG9ycyIsInZpZXdfb3duX3VzZXJfYWNjb3VudCIsIm15X3VzZXJfYWNjb3VudCIsInNldHVwX2NsaWVudCIsInZpZXdfdGVjaG5pY2FsX3NldHVwIiwidGVjaG5pY2FsX3JvbGVzX21hbmFnZW1lbnQiLCJ2aWV3X2lkcCIsInVwbG9hZF9kb2N1bWVudHMiLCJ2aWV3X25vdGlmaWNhdGlvbnMiLCJ2aWV3X2F1dG9zZXR1cF9zdGF0dXMiLCJkZWxldGVfb3duX3VzZXJfYWNjb3VudCIsInN1YnNjcmliZV9zZXJ2aWNlIiwidmlld19hcHBfc3Vic2NyaXB0aW9uIiwiYWN0aXZhdGVfc3Vic2NyaXB0aW9uIiwidmlld19zZXJ2aWNlX21hcmtldHBsYWNlIiwidmlld19jZXJ0aWZpY2F0ZXMiLCJhZGRfdXNlcl9hY2NvdW50Iiwidmlld19tZW1iZXJzaGlwIiwiZGVsZXRlX3VzZXJfYWNjb3VudCIsInZpZXdfdXNlX2Nhc2VzIiwiZGVsZXRlX3RlY2hfdXNlcl9tYW5hZ2VtZW50IiwiZGlzYWJsZV9pZHAiLCJ2aWV3X3VzZXJfbWFuYWdlbWVudCIsInZpZXdfYXBwcyIsInVwZGF0ZV9vd25fdXNlcl9hY2NvdW50Il19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX0sIkNsMy1DWC1TZW1hbnRpYyI6eyJyb2xlcyI6WyJ2aWV3X3NlbWFudGljX21vZGVsIl19fSwic2NvcGUiOiJvcGVuaWQgY2F0ZW5hIHByb2ZpbGUgZW1haWwiLCJzaWQiOiI4OWNjODMxNy1lYzljLTQ2NjYtODU0Ni01NTJmZjdlM2M1M2YiLCJicG4iOiJCUE5MMDAwMDAwMDNDUUk5IiwiZW1haWxfdmVyaWZpZWQiOnRydWUsIm5hbWUiOiJDaHJpc3RvcGggSnVuZyIsIm9yZ2FuaXNhdGlvbiI6IktBIENvbnN1bWVyIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiaWRwMzEuOTdmNGI3OGMtYzM2ZC00MzU3LTgyYjItNjMzNDQ1ZjYyMjZmIiwiZ2l2ZW5fbmFtZSI6IkNocmlzdG9waCIsImZhbWlseV9uYW1lIjoiSnVuZyIsImVtYWlsIjoiYy1qdW5nQHQtc3lzdGVtcy5jb20ifQ.xGudbdYEtfzQLx11VmGx8fuOw4iGJAFgNVtcZZ5rBZx5qeZwjxESLN0ueYhW1F_OGWezMNt_1KG952aMAQrPb4hru0bVWFaGZJ6A-HS968vYVIXjv-urYqOp4T8TZasICbTuypl74cAywR32VNOLxmEDIiNl_ybPovt7FjE2g9Usky1AMcWrHsdU1aNQN8DAfxFID-0hUriGNc10sVOy9YWRvC1uN4dcvw_Vi76Fhf5_1FH-5x90aNvmcdimksAz0FUwL4uKH0DBxTUYgheU-qHWvI7bDZqufjf9PBCBNf2NwAL2DMtXzIpQqI130t2BDLt2Gl1vCob1d5ItX8i-sQ"
          
          #curl -X GET https://knowledge.dev.demo.catena-x.net/conforming-agent/bind --user "${{ secrets.BASIC_AUTH_USER }}:${{ secrets.BASIC_AUTH_PASSWORD }}"
          #curl -X GET https://knowledge.dev.demo.catena-x.net/conforming-agent/bind --header "Authorization: Basic ${{ secrets.BASIC_AUTH_TOKEN }}"
          #curl -X GET https://knowledge.dev.demo.catena-x.net/conforming-agent/bind --header "X-Api-Key: ${{ secrets.API_KEY }}"
          #curl -X GET https://knowledge.dev.demo.catena-x.net/conforming-agent/bind --header "Authorization: Bearer ${{ secrets.OUTH2 }}"

      - name: GitHub Workflow artifacts
        uses: actions/upload-artifact@v2
        with:
          name: nuclei.log
          path: nuclei.log

      - name: GitHub Security Dashboard Alerts update
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: nuclei.sarif
